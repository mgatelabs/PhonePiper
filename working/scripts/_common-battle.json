{
  "vars": [
    {
      "name": "setup",
      "value": "0",
      "type": "INT"
    }
  ],
  "imports": [
    "_common-no_op"
  ],
  "states": {
    "_common_battle-three_attack": {
      "name": "Common Battle - Two or Three Attack",
      "statements": [
        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "0"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Two Attack"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "BATCH",
              "value": "START"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "0"
              }
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "1"
              }
            },
            {
              "type": "BATCH",
              "value": "END"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "CALL",
            "value": "@isBattleReady",
            "and": [
              {
                "var": "_loops",
                "is": "GREATER",
                "value": "8"
              },
              { "is": "CALL", "value": "@isUnitReady", "args": {"index": "2"} }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Third Attack"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {
                "index": "2"
              }
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "var": "_loops",
            "is": "GREATER",
            "value": "20",
            "and": [
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Enabling Auto - Pause Detected"
            },
            {
              "type": "TAP",
              "value": "battle-auto"
            },
            { "type": "CALL", "value": "@keepAlive" },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        }
      ]
    },
    "_common_battle-auto": {
      "name": "Common Battle - Auto",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off",
                "or": [
                  {
                    "is": "SCREEN",
                    "value": "game-battle-repeat"
                  }
                ]
              },
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Auto-Attack"
            },
            {
              "type": "TAP",
              "value": "battle-auto"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "not": "SCREEN",
                "value": "game-battle-auto_off"
              }
            ]
          },
          "actions": [
            { "type": "CALL", "value": "@keepAlive" }
          ]
        }
      ]
    },
    "_common_battle-repeat": {
      "name": "Common Battle - Repeat",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off",
                "or": [
                  {
                    "is": "SCREEN",
                    "value": "game-battle-repeat"
                  }
                ]
              },
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Repeat-Attack"
            },
            {
              "type": "TAP",
              "value": "battle-repeat"
            },
            {
              "type": "TAP",
              "value": "battle-unit_5",
              "count": "1"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "not": "SCREEN",
                "value": "game-battle-auto_off"
              }
            ]
          },
          "actions": [
            { "type": "CALL", "value": "@keepAlive" }
          ]
        }
      ]
    },
    "@showUnitActions": {
      "name": "Function - Show Unit's Actions",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "SWIPE_RIGHT",
              "value": "battle-unit_${index}"
            },
            {
              "type": "WAIT",
              "value": "200"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@selectUnitAction": {
      "name": "Function - Select a single unit's action",
      "variables": {
        "row": {
          "value": "0",
          "type": "INT"
        },
        "column": {
          "value": "0",
          "type": "INT"
        },
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "LESS",
            "var": "row",
            "value": "3"
          },
          "actions": [
            {
              "type": "MATH",
              "value": "${row}+(${column}*3)",
              "var": "index"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "MATH",
              "value": "${row}-2",
              "var": "row"
            },
            {
              "type": "SLOW_UP",
              "value": "battle-skill-top-slider",
              "count": "${row}"
            },
            {
              "type": "MATH",
              "value": "2+(${column}*3)",
              "var": "index"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@selectQuadUnitActionSafely": {
      "name": "Function - Select a unit's action four times",
      "variables": {
        "row": {
          "value": "0",
          "type": "INT"
        },
        "column": {
          "value": "0",
          "type": "INT"
        },
        "index": {
          "value": "0",
          "type": "INT"
        },
        "safety": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        // No need to drill down
        {
          "condition": {
            "is": "LESS",
            "var": "row",
            "value": "3"
          },
          "actions": [
            {
              "type": "SET",
              "value": "1",
              "var": "safety"
            },
            {
              "type": "MATH",
              "value": "${row}+(${column}*3)",
              "var": "index"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "is": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        // Need to drill down
        {
          "condition": {
            "is": "EQUAL",
            "var": "safety",
            "value": "0"
          },
          "actions": [
            {
              "type": "MATH",
              "value": "${row}-2",
              "var": "row"
            },
            {
              "type": "SLOW_UP",
              "value": "battle-skill-top-slider",
              "count": "${row}"
            },
            {
              "type": "MATH",
              "value": "2+(${column}*3)",
              "var": "index"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "is": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        // Failover
        {
          "actions": [
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "is": "SCREEN",
                "value": "battle-actions"
              },
              "type": "TAP",
              "value": "battle-actions-back"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        }
      ]
    },
    "@showUnitActions": {
      "name": "Function - Show Unit's Actions",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "SWIPE_RIGHT",
              "value": "battle-unit_${index}"
            },
            {
              "type": "WAIT",
              "value": "750"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@tapUnit": {
      "name": "Function - Tap Unit",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "TAP",
              "value": "battle-unit_${index}"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@readyUnitGuard": {
      "name": "Function - Ready Unit Guard",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "SWIPE_DOWN",
              "value": "battle-unit_${index}"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@tapAbilityItem": {
      "name": "Function - Tap Ability Item",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        },
        "count": {
          "value": "1",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "TAP",
              "value": "battle-skill-top-${index}",
              "count": "1"
            },
            {
              "condition": {
                "is":"EQUAL",
                "var": "device-type",
                "value": "1"
              },
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "ADD",
              "var": "count",
              "value": "-1"
            },
            {
              "condition": {
                "is":"GREATER",
                "var": "count",
                "value": "0"
              },
              "type": "CALL",
              "value": "@tapAbilityItem",
              "args": {
                "index": "${index}",
                "count": "${count}"
              }
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@readyUnitLb": {
      "name": "Function - Ready Unit LB",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "${index}"
              }
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-0",
              "count": "1"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@readyUnitLbSafely": {
      "name": "Function - Ready Unit LB Safely",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "${index}"
              }
            },
            {
              "type": "FINER",
              "value": "Refreshing Screen"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "FINER",
              "value": "Checking screen"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-abilities-lb-available"
              },
              "type": "CONTINUE"
            },
            {
              "type": "FINER",
              "value": "LB Available"
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-0",
              "count": "1"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "FINER",
              "value": "LB wasn't actually available"
            },
            {
              "type": "TAP",
              "value": "battle-actions-back"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@readyQuadMagicSafely": {
      "name": "Function - Ready Quad Magic Safely",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        },
        "row0": {
          "value": "0",
          "type": "INT"
        },
        "column0": {
          "value": "0",
          "type": "INT"
        },
        "row1": {
          "value": "0",
          "type": "INT"
        },
        "column1": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "${index}"
              }
            },
            {
              "type": "CALL",
              "value": "@selectUnitAction",
              "args": {
                "row": "${row0}",
                "column": "${column0}"
              }
            },
            {
              "type": "FINER",
              "value": "Refreshing Screen"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "FINER",
              "value": "Checking screen"
            },
            {
              "condition":{
                "not": "SCREEN",
                "value": "battle-actions"
              },
              "type": "CONTINUE"
            },
            {
              "type": "FINER",
              "value": "Still on Action Screen"
            },
            {
              "type": "SWIPE_DOWN",
              "value": "battle-skill-top-slider",
              "count": "5"
            },
            {
              "condition": {
                "not": "CALL",
                "value": "@selectQuadUnitActionSafely",
                "args": {
                  "row": "${row1}",
                  "column": "${column2}"
                }
              },
              "type": "CONTINUE"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "FINER",
              "value": "We had problems"
            },
            {
              "type": "REFRESH"
            },
            {
              "condition":{
                "is": "SCREEN",
                "value": "battle-actions"
              },
              "type": "TAP",
              "value": "battle-actions-back"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "REFRESH"
            },
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@readyUnitEsper": {
      "name": "Function - Ready Unit Esper",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "CALL",
              "value": "@showUnitActions",
              "args": {
                "index": "${index}"
              }
            },
            {
              "type": "TAP",
              "value": "battle-skill-top-3",
              "count": "1"
            },
            {
              "type": "WAIT",
              "value": "500"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },
    "@isUnitReady": {
      "name": "Function - Is Unit Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_ready"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isUnitAtkReady": {
      "name": "Function - Is Unit Attack Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "not": "SCREEN",
            "value": "battle-unit-${index}_ability",
            "and": [
              {
                "not": "SCREEN",
                "value": "battle-unit-${index}_lb"
              },
              {
                "not": "SCREEN",
                "value": "battle-unit-${index}_magic"
              }
            ]
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isUnitLbReady": {
      "name": "Function - Is Unit Limit Break Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_notfull"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        }
      ]
    },
    "@isUnitActionReady": {
      "name": "Function - Is Unit Action Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_ability"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isUnitMagicReady": {
      "name": "Function - Is Unit Magic Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_magic"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isUnitLbSelected": {
      "name": "Function - Is Unit LB Selected",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_lb"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isUnitMpReady": {
      "name": "Function - Is Unit MP Ready",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-unit-${index}_mp"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    },
    "@isEsperReady": {
      "name": "Function - Is Esper Ready",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "battle-esper-notfull"
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        }
      ]
    },
    "@isBattleReady": {
      "name": "Function - Is Battle Ready",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off"
              },
              {
                "is": "SCREEN",
                "value": "game-battle-repeat"
              }
            ]
          },
          "actions": [
            {
              "type": "RETURN",
              "value": "1"
            }
          ]
        },
        {
          "actions": [
            {
              "type": "RETURN",
              "value": "0"
            }
          ]
        }
      ]
    }
  }
}